.mq-kafka__grid {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 14px;
  position: relative;
  align-items: start;
}

.mq-kafka__grid.mode--replica .mq-replicas .replica,

.mq-kafka__grid.mode--ack .mq-acks {
  opacity: 1;
}

.kafka-diagram {
  display: grid;
  gap: 16px;
}

.partition-card {
  padding: 6px 12px;
  border-radius: 999px;
  border: 1px solid var(--line);
  background: rgba(42, 111, 107, 0.12);
  font-size: 0.8rem;
  transition: transform 0.3s ease, border-color 0.3s ease;
}

.partition-card.leader {
  border-color: var(--accent);
  background: rgba(210, 100, 42, 0.18);
}

.kafka-diagram.mode--partition .arrow {
  opacity: 1;
  animation: flow 1.8s ease infinite;
}

.broker-card {
  border: 1px solid var(--line);
  border-radius: 16px;
  background: #fff;
  padding: 12px;
  display: grid;
  gap: 10px;
  position: relative;
}

.broker-title {
  font-weight: 600;
}

.broker-log {
  display: grid;
  gap: 6px;
}

.isr-badge {
  position: absolute;
  top: 8px;
  right: 8px;
  padding: 4px 8px;
  border-radius: 999px;
  border: 1px dashed rgba(210, 100, 42, 0.4);
  font-size: 0.7rem;
  color: var(--accent);
  background: rgba(210, 100, 42, 0.12);
  opacity: 0.4;
}

.kafka-diagram.mode--replica .isr-badge {
  opacity: 1;
}

.kafka-diagram.mode--replica .replication-line {
  opacity: 1;
  background: rgba(42, 111, 107, 0.5);
  animation: frameFlow 1.6s ease infinite;
}

.ack-card {
  padding: 6px 12px;
  border-radius: 999px;
  border: 1px solid var(--line);
  background: #fff;
  font-size: 0.8rem;
  opacity: 0.6;
}

.kafka-diagram.mode--ack .ack-card {
  opacity: 1;
  border-color: var(--accent);
}

.ack-flow {
  position: absolute;
  bottom: -6px;
  width: 160px;
  height: 2px;
  background: rgba(210, 100, 42, 0.5);
  opacity: 0;
}

.kafka-diagram.mode--ack .ack-flow {
  opacity: 1;
  animation: shimmer 2s ease infinite;
}

.mq-group .consumer {
  padding: 10px 14px;
  border-radius: 12px;
  border: 1px solid var(--line);
  background: rgba(42, 111, 107, 0.12);
  font-weight: 600;
}

.mq-group .consumer.ghost {
  opacity: 0.4;
}
