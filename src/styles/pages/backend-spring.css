/* ── Spring Core Principles ── */
.spring-diagram { width: min(100%, 780px); margin: 0 auto; }
.spring-scene { display: flex; flex-direction: column; gap: 10px; }
.spring-svg { width: 100%; height: auto; display: block; }

/* ── Progress bar ── */
.spring-progress {
  height: 3px;
  border-radius: 3px;
  background: rgba(0, 0, 0, 0.06);
  overflow: hidden;
}
.spring-progress__fill {
  height: 100%;
  border-radius: 3px;
  background: linear-gradient(90deg, rgba(42,111,107,0.8), rgba(76,120,168,0.8), rgba(210,100,42,0.8));
  transition: width 0.5s ease;
}

/* ── Text styles ── */
.spring-heading {
  text-anchor: middle;
  font-size: 13px;
  font-weight: 600;
  fill: var(--ink-soft, #555);
  font-family: system-ui, sans-serif;
}
.spring-hint {
  text-anchor: middle;
  font-size: 10px;
  fill: rgba(0,0,0,0.25);
}

/* ── IoC Container ── */
.spring-container {
  fill: rgba(42,111,107,0.02);
  stroke: rgba(42,111,107,0.18);
  stroke-width: 1.5;
  stroke-dasharray: 8 4;
  animation: springContainerPulse 3s ease-in-out infinite;
}
.spring-container-label {
  font-size: 11px;
  font-weight: 600;
  font-family: "SF Mono", "Fira Code", monospace;
  fill: rgba(42,111,107,0.5);
}

/* ── Beans ── */
.spring-bean {
  fill: rgba(255,255,255,0.9);
  stroke: var(--bean-c);
  stroke-width: 1;
  stroke-opacity: 0.35;
  filter: drop-shadow(0 1px 3px rgba(0,0,0,0.04));
}
.spring-bean-text {
  text-anchor: middle;
  font-size: 10px;
  font-weight: 600;
  font-family: "SF Mono", "Fira Code", monospace;
  fill: rgba(0,0,0,0.5);
}
.spring-bean-g--visible { opacity: 1; transition: opacity 0.4s; }
.spring-bean-g--hidden { opacity: 0.15; transition: opacity 0.4s; }
.spring-bean-g--registering {
  animation: springBeanRegister 0.6s ease-out both;
  animation-delay: var(--bean-delay, 0s);
}
.spring-anno {
  text-anchor: middle;
  font-size: 9px;
  font-weight: 500;
  font-family: "SF Mono", "Fira Code", monospace;
  fill: rgba(140,80,180,0.5);
}

/* ── DI arrows ── */
.spring-di-arrow {
  animation: springFadeIn 0.5s ease-out both;
  animation-delay: var(--di-delay, 0s);
}
.spring-di-line {
  stroke: rgba(42,111,107,0.3);
  stroke-width: 1.5;
  stroke-dasharray: 6 3;
}
.spring-di-label {
  text-anchor: middle;
  font-size: 9px;
  font-weight: 500;
  font-family: "SF Mono", "Fira Code", monospace;
  fill: rgba(42,111,107,0.5);
}

/* ── Scan ── */
.spring-scan-box {
  fill: rgba(76,120,168,0.06);
  stroke: rgba(76,120,168,0.2);
  stroke-width: 1;
}
.spring-scan-text {
  text-anchor: middle;
  font-size: 9px;
  font-weight: 600;
  font-family: "SF Mono", "Fira Code", monospace;
  fill: rgba(76,120,168,0.6);
}
.spring-scan-line {
  stroke: rgba(76,120,168,0.3);
  stroke-width: 1;
}
.spring-scan-g {
  animation: springFadeIn 0.6s ease-out both;
}

/* ── Lifecycle ── */
.spring-timeline {
  stroke: rgba(0,0,0,0.08);
  stroke-width: 2;
}
.spring-lc-stage {
  animation: springFadeIn 0.5s ease-out both;
  animation-delay: var(--lc-delay, 0s);
}
.spring-lc-node {
  fill: rgba(255,255,255,0.9);
  stroke: var(--lc-c);
  stroke-width: 1.5;
  stroke-opacity: 0.5;
  animation: springNodePulse 2.5s ease-in-out infinite;
  animation-delay: var(--lc-delay, 0s);
}
.spring-lc-num {
  text-anchor: middle;
  dominant-baseline: central;
  font-size: 11px;
  font-weight: 700;
  fill: rgba(0,0,0,0.35);
}
.spring-lc-label {
  text-anchor: middle;
  font-size: 11px;
  font-weight: 600;
}
.spring-lc-sub {
  text-anchor: middle;
  font-size: 9px;
  font-family: "SF Mono", "Fira Code", monospace;
  fill: rgba(0,0,0,0.25);
}
.spring-lc-arrow {
  stroke: rgba(0,0,0,0.1);
  stroke-width: 1.5;
}
.spring-bpp-box {
  fill: rgba(210,100,42,0.04);
  stroke: rgba(210,100,42,0.18);
  stroke-width: 1;
}
.spring-bpp-text {
  text-anchor: middle;
  font-size: 10px;
  font-weight: 500;
  font-family: "SF Mono", "Fira Code", monospace;
  fill: rgba(210,100,42,0.6);
}
.spring-bpp-line {
  stroke: rgba(210,100,42,0.2);
  stroke-width: 1;
}

/* ── AOP concepts ── */
.spring-aop-link {
  stroke: rgba(0,0,0,0.08);
  stroke-width: 1;
}
.spring-aop-concept {
  animation: springFadeIn 0.5s ease-out both;
  animation-delay: var(--aop-delay, 0s);
}
.spring-aop-box {
  fill: rgba(255,255,255,0.9);
  stroke: var(--aop-c);
  stroke-width: 1;
  stroke-opacity: 0.35;
  filter: drop-shadow(0 1px 3px rgba(0,0,0,0.04));
}
.spring-aop-name {
  text-anchor: middle;
  font-size: 11px;
  font-weight: 600;
  font-family: "SF Mono", "Fira Code", monospace;
}
.spring-aop-sub {
  text-anchor: middle;
  font-size: 9px;
  fill: rgba(0,0,0,0.3);
}
.spring-aop-hint {
  text-anchor: middle;
  font-size: 9px;
  fill: rgba(210,100,42,0.5);
  font-family: "SF Mono", "Fira Code", monospace;
}

/* ── AOP Proxy ── */
.spring-target-box {
  fill: rgba(42,111,107,0.04);
  stroke: rgba(42,111,107,0.2);
  stroke-width: 1;
}
.spring-target-label {
  text-anchor: middle;
  font-size: 11px;
  font-weight: 600;
  fill: rgba(42,111,107,0.7);
}
.spring-target-sub {
  text-anchor: middle;
  font-size: 9px;
  font-family: "SF Mono", "Fira Code", monospace;
  fill: rgba(0,0,0,0.25);
}
.spring-factory-box {
  fill: rgba(76,120,168,0.04);
  stroke: rgba(76,120,168,0.2);
  stroke-width: 1;
  animation: springNodePulse 2.5s ease-in-out infinite;
}
.spring-factory-label {
  text-anchor: middle;
  font-size: 11px;
  font-weight: 600;
  fill: rgba(76,120,168,0.7);
}
.spring-factory-sub {
  text-anchor: middle;
  font-size: 9px;
  font-family: "SF Mono", "Fira Code", monospace;
  fill: rgba(0,0,0,0.25);
}
.spring-proxy-box {
  fill: rgba(210,100,42,0.04);
  stroke: rgba(210,100,42,0.25);
  stroke-width: 1;
  animation: springProxyGlow 2s ease-in-out infinite;
}
.spring-proxy-label {
  text-anchor: middle;
  font-size: 11px;
  font-weight: 600;
  fill: rgba(210,100,42,0.7);
}
.spring-proxy-sub {
  text-anchor: middle;
  font-size: 8px;
  font-family: "SF Mono", "Fira Code", monospace;
  fill: rgba(0,0,0,0.25);
}
.spring-proxy-arrow {
  stroke: rgba(0,0,0,0.15);
  stroke-width: 1.5;
}
.spring-jdk-box {
  fill: rgba(76,120,168,0.05);
  stroke: rgba(76,120,168,0.18);
  stroke-width: 1;
}
.spring-jdk-text {
  text-anchor: middle;
  font-size: 10px;
  font-weight: 600;
  fill: rgba(76,120,168,0.65);
  font-family: "SF Mono", "Fira Code", monospace;
}
.spring-jdk-hint {
  text-anchor: middle;
  font-size: 8px;
  fill: rgba(0,0,0,0.2);
}
.spring-cglib-box {
  fill: rgba(210,100,42,0.05);
  stroke: rgba(210,100,42,0.18);
  stroke-width: 1;
}
.spring-cglib-text {
  text-anchor: middle;
  font-size: 10px;
  font-weight: 600;
  fill: rgba(210,100,42,0.65);
  font-family: "SF Mono", "Fira Code", monospace;
}
.spring-cglib-hint {
  text-anchor: middle;
  font-size: 8px;
  fill: rgba(0,0,0,0.2);
}

/* ── Three-Level Cache ── */
.spring-cache-row {
  animation: springFadeIn 0.5s ease-out both;
  animation-delay: var(--cache-delay, 0s);
}
.spring-cache-box {
  fill: rgba(255,255,255,0.9);
  stroke: var(--cache-c);
  stroke-width: 1;
  stroke-opacity: 0.3;
  filter: drop-shadow(0 1px 3px rgba(0,0,0,0.04));
}
.spring-cache-label {
  font-size: 12px;
  font-weight: 600;
}
.spring-cache-sub {
  text-anchor: middle;
  font-size: 10px;
  font-family: "SF Mono", "Fira Code", monospace;
  fill: rgba(0,0,0,0.35);
}
.spring-cache-desc {
  text-anchor: end;
  font-size: 10px;
  fill: rgba(0,0,0,0.25);
}
.spring-cache-step {
  animation: springFadeIn 0.4s ease-out both;
  animation-delay: var(--cache-delay, 0s);
}
.spring-cache-node {
  fill: rgba(255,255,255,0.9);
  stroke: var(--cache-c);
  stroke-width: 1.5;
  stroke-opacity: 0.5;
  animation: springNodePulse 2.5s ease-in-out infinite;
  animation-delay: var(--cache-delay, 0s);
}
.spring-cache-step-label {
  text-anchor: middle;
  font-size: 10px;
  font-weight: 600;
}
.spring-cache-step-desc {
  text-anchor: middle;
  font-size: 9px;
  font-family: "SF Mono", "Fira Code", monospace;
  fill: rgba(0,0,0,0.25);
}

/* ── Circular dependency ── */
.spring-circ-box {
  stroke-width: 1;
  filter: drop-shadow(0 1px 3px rgba(0,0,0,0.04));
}
.spring-circ-box--a {
  fill: rgba(42,111,107,0.04);
  stroke: rgba(42,111,107,0.25);
}
.spring-circ-box--b {
  fill: rgba(76,120,168,0.04);
  stroke: rgba(76,120,168,0.25);
}
.spring-circ-name {
  text-anchor: middle;
  font-size: 12px;
  font-weight: 600;
}
.spring-circ-sub {
  text-anchor: middle;
  font-size: 9px;
  font-family: "SF Mono", "Fira Code", monospace;
  fill: rgba(0,0,0,0.25);
}
.spring-circ-arrow {
  stroke: rgba(210,100,42,0.35);
  stroke-width: 1.5;
}
.spring-circ-arrow--top {
  animation: springCircPulse 2s ease-in-out infinite;
}
.spring-circ-arrow--bottom {
  animation: springCircPulse 2s ease-in-out infinite 0.5s;
}
.spring-circ-dep {
  text-anchor: middle;
  font-size: 10px;
  font-weight: 500;
  fill: rgba(210,100,42,0.6);
}
.spring-circ-warn {
  fill: rgba(210,100,42,0.05);
  stroke: rgba(210,100,42,0.2);
  stroke-width: 1;
}
.spring-circ-warn-text {
  text-anchor: middle;
  font-size: 11px;
  font-weight: 500;
  fill: rgba(210,100,42,0.65);
}

/* ── AOP Intercept chain ── */
.spring-chain-box {
  fill: rgba(0,0,0,0.015);
  stroke: rgba(0,0,0,0.08);
  stroke-width: 1;
}
.spring-chain-title {
  text-anchor: middle;
  font-size: 10px;
  font-weight: 500;
  fill: rgba(0,0,0,0.25);
  font-family: "SF Mono", "Fira Code", monospace;
}
.spring-chain-line {
  stroke: rgba(0,0,0,0.08);
  stroke-width: 2;
}
.spring-advice-g {
  animation: springFadeIn 0.4s ease-out both;
  animation-delay: var(--adv-delay, 0s);
}
.spring-advice-dot {
  fill: var(--adv-c);
  opacity: 0.6;
  animation: springDotPulse 2s ease-in-out infinite;
  animation-delay: var(--adv-delay, 0s);
}
.spring-advice-bar {
  fill: rgba(255,255,255,0.9);
  stroke: var(--adv-c);
  stroke-width: 1;
  stroke-opacity: 0.3;
}
.spring-advice-text {
  text-anchor: middle;
  font-size: 11px;
  font-weight: 600;
  font-family: "SF Mono", "Fira Code", monospace;
}
.spring-advice-conn {
  stroke: rgba(0,0,0,0.06);
  stroke-width: 1;
}
.spring-caller-text {
  text-anchor: middle;
  font-size: 10px;
  fill: rgba(0,0,0,0.3);
}

/* ── Flow ── */
.spring-flow-label {
  font-size: 10px;
  font-weight: 600;
  fill: rgba(0,0,0,0.2);
}
.spring-flow-node {
  animation: springFadeIn 0.4s ease-out both;
  animation-delay: var(--flow-delay, 0s);
}
.spring-flow-box {
  fill: rgba(255,255,255,0.9);
  stroke: var(--flow-c);
  stroke-width: 1;
  stroke-opacity: 0.35;
  filter: drop-shadow(0 1px 3px rgba(0,0,0,0.04));
}
.spring-flow-name {
  text-anchor: middle;
  font-size: 10px;
  font-weight: 600;
  font-family: "SF Mono", "Fira Code", monospace;
}
.spring-flow-sub {
  text-anchor: middle;
  font-size: 8px;
  font-family: "SF Mono", "Fira Code", monospace;
  fill: rgba(0,0,0,0.2);
}
.spring-flow-arrow {
  stroke: rgba(0,0,0,0.12);
  stroke-width: 1;
}
.spring-flow-divider {
  stroke: rgba(0,0,0,0.06);
  stroke-width: 1;
}

/* ── Phase bar ── */
.spring-phase-bar {
  padding: 10px 14px;
  border-radius: 12px;
  border: 1px solid var(--line, rgba(0,0,0,0.08));
  background: rgba(255,255,255,0.8);
  display: flex;
  align-items: center;
  gap: 10px;
}
.spring-phase-bar__tag {
  font-size: 11px;
  font-weight: 600;
  font-family: "SF Mono", "Fira Code", monospace;
  padding: 3px 10px;
  border-radius: 6px;
  white-space: nowrap;
  flex-shrink: 0;
  background: color-mix(in srgb, var(--phase-c) 8%, transparent);
  color: var(--phase-c);
}
.spring-phase-bar__steps { display: flex; flex-wrap: wrap; gap: 6px; }
.spring-phase-bar__step {
  font-size: 11px;
  font-family: "SF Mono", "Fira Code", monospace;
  padding: 3px 10px;
  border-radius: 6px;
  border: 1px solid var(--line, rgba(0,0,0,0.08));
  background: #fff;
  opacity: 0.3;
  transition: opacity 0.3s, background 0.3s, border-color 0.3s, color 0.3s;
}
.spring-phase-bar__step.is-past { opacity: 0.55; }
.spring-phase-bar__step.is-active {
  opacity: 1;
  background: color-mix(in srgb, var(--phase-c) 6%, transparent);
  border-color: color-mix(in srgb, var(--phase-c) 25%, transparent);
  color: var(--phase-c);
}

/* ── Keyframes ── */
@keyframes springContainerPulse {
  0%, 100% { stroke-opacity: 0.18; }
  50% { stroke-opacity: 0.35; filter: drop-shadow(0 0 6px rgba(42,111,107,0.06)); }
}
@keyframes springBeanRegister {
  from { opacity: 0; transform: translateY(-8px); }
  to { opacity: 1; transform: translateY(0); }
}
@keyframes springFadeIn {
  from { opacity: 0; }
  to { opacity: 1; }
}
@keyframes springNodePulse {
  0%, 100% { stroke-opacity: 0.5; filter: none; }
  50% { stroke-opacity: 0.8; filter: drop-shadow(0 0 4px rgba(0,0,0,0.06)); }
}
@keyframes springProxyGlow {
  0%, 100% { stroke-opacity: 0.25; }
  50% { stroke-opacity: 0.5; filter: drop-shadow(0 0 6px rgba(210,100,42,0.15)); }
}
@keyframes springDotPulse {
  0%, 100% { opacity: 0.4; r: 5; }
  50% { opacity: 0.9; r: 7; }
}
@keyframes springCircPulse {
  0%, 100% { stroke-opacity: 0.35; }
  50% { stroke-opacity: 0.7; filter: drop-shadow(0 0 4px rgba(210,100,42,0.15)); }
}

/* ── Responsive ── */
@media (max-width: 640px) {
  .spring-heading { font-size: 11px; }
  .spring-anno { display: none; }
  .spring-jdk-hint { display: none; }
  .spring-cglib-hint { display: none; }
  .spring-flow-sub { display: none; }
  .spring-bpp-box { display: none; }
  .spring-bpp-text { display: none; }
  .spring-bpp-line { display: none; }
  .spring-phase-bar__step { font-size: 9px; padding: 2px 7px; }
  .spring-lc-sub { display: none; }
  .spring-caller-text { display: none; }
}
